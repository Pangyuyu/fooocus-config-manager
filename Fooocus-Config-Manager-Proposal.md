# Fooocus 配置管理器方案

## 一、项目背景

### 1.1 问题描述

Fooocus 是一款基于 Stable Diffusion 的 AI 图像生成工具，以其简洁的界面和强大的功能受到广泛欢迎。然而，在实际使用过程中，用户经常面临以下困扰：

- **配置难以记忆**：每次选择模型、设置提示词、反向提示词后，难以记住所有配置细节
- **预设管理不便**：Fooocus 的预设（Presets）存储在 JSON 文件中，需要手动编辑才能创建新预设
- **风格选择混乱**：多个风格（Styles）组合使用后，无法快速回忆之前使用过的有效组合
- **配置复用困难**：无法方便地在不同配置之间切换和比较

### 1.2 用户痛点

| 痛点 | 描述 |
|------|------|
| 记忆负担 | 需要记住多个模型、提示词、风格的组合 |
| 配置分散 | 配置信息分散在预设文件、界面状态等多个位置 |
| 复用性差 | 难以快速复用之前使用过的成功配置 |
| 缺乏记录 | 没有系统化的方式记录每次生成使用的配置 |

### 1.3 目标用户

- 频繁使用 Fooocus 进行 AI 图像生成的用户
- 需要管理多个模型和预设的专业设计师
- 希望建立个人配置知识库的 AI 爱好者

---

## 二、需求分析

### 2.1 需要记录的配置项

根据 Fooocus 的预设（Preset）结构和实际使用场景，本工具需要管理以下配置项：

#### 2.1.1 核心配置

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 预设名称 | 配置方案的名称 | string |
| 预设描述 | 配置方案的简要描述 | string |
| 创建时间 | 记录创建时间 | datetime |
| 更新时间 | 记录最后修改时间 | datetime |
| 标签 | 用于分类和检索 | string[] |

#### 2.1.2 模型配置

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 基础模型 | 主要使用的 Checkpoint 模型 | string |
| 精修模型 | Refiner 模型（可选） | string |
| 精修切换点 | Refiner 切换的步数比例 | float |
| LoRA 模型 | 使用的 LoRA 及权重 | LoRA[] |

```
LoRA 结构:
{
  "name": string,        // LoRA 名称
  "model_name": string,  // 模型文件名
  "weight": float        // 权重 (-1 ~ 2)
}
```

#### 2.1.3 采样参数

| 配置项 | 说明 | 数据类型 | 常见值 |
|--------|------|----------|--------|
| CFG Scale | 引导强度 | float | 1.0 ~ 30.0 |
| 采样锐度 | 图像锐度 | float | 0.0 ~ 10.0 |
| 采样器 | 采样算法 | enum | dpmpp_2m_sde_gpu, euler, etc. |
| 调度器 | 噪声调度方式 | enum | karras, normal, etc. |
| 性能模式 | 生成速度/质量平衡 | enum | Speed, Quality, Lightning |
| 步数 | 采样步数 | int | 1 ~ 200 |

#### 2.1.4 提示词配置

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 正向提示词 | 主要的生成描述 | string |
| 反向提示词 | 需要避免的元素 | string |
| 风格列表 | 启用的风格 | string[] |

#### 2.1.5 图像参数

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 宽高比 | 输出图像尺寸 | string (如 "1152*896") |
| 图像数量 | 同时生成的图像数 | int |

#### 2.1.6 资源下载（可选）

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 模型下载链接 | Checkpoint 下载地址 | map |
| LoRA 下载链接 | LoRA 模型下载地址 | map |
| Embedding 下载链接 | Textual Inversion 下载地址 | map |

### 2.2 功能需求

#### 2.2.1 配置记录与管理

- **创建配置**：手动创建新的配置方案
- **导入配置**：从 Fooocus 预设 JSON 文件导入
- **编辑配置**：修改现有配置的任意字段
- **删除配置**：删除不需要的配置
- **复制配置**：基于现有配置创建副本
- **收藏配置**：标记常用的配置为收藏

#### 2.2.2 配置浏览与检索

- **列表视图**：以列表形式展示所有配置
- **卡片视图**：以卡片形式展示配置概览
- **搜索功能**：按名称、标签、模型等关键词搜索
- **筛选功能**：按标签、模型、创建时间等条件筛选
- **排序功能**：按名称、更新时间、使用频率等排序

#### 2.2.3 配置导出

- **导出为 Fooocus 预设**：生成符合 Fooocus 格式的 JSON 文件
- **导出为图片元数据**：将配置信息写入图片的 EXIF 数据
- **批量导出**：一次性导出多个配置

#### 2.2.4 配置使用

- **一键应用**：快速将配置复制到剪贴板或直接应用到 Fooocus
- **快速预览**：查看配置的详细信息
- **对比模式**：并排比较两个配置的区别

#### 2.2.5 数据管理

- **数据持久化**：本地存储配置数据
- **数据导入/导出**：备份和恢复整个配置库
- **数据统计**：展示配置使用统计（使用次数、创建时间分布等）

### 2.3 非功能需求

- **易用性**：界面简洁直观，学习成本低
- **性能**：配置加载和搜索响应时间 < 200ms
- **兼容性**：支持 Windows、macOS、Linux
- **可扩展性**：方便添加新的配置项和功能
- **数据安全**：本地存储，无云端传输，保护用户隐私

---

## 三、方案设计

### 3.1 技术选型

#### 3.1.1 界面形式：桌面应用（本地运行）

**推荐方案**：使用 Tauri + Vue3 构建桌面应用

| 方案 | 优点 | 缺点 |
|------|------|------|
| Electron + Vue3 | 跨平台、原生体验、可访问本地文件系统 | 包体积较大 |
| Tauri + Vue3 | 包体积小、性能好、安全性高 | 生态相对较小 |
| Vue3 单页应用 | 开发简单、可部署到任意静态服务器 | 需要手动处理本地存储 |

**最终推荐**：**Tauri + Vue3**

理由：
- 轻量级，包体积小（~10MB vs Electron 的 ~150MB）
- 性能优秀，启动速度快
- 安全性好，默认禁用远程代码执行
- 可以轻松读写本地文件系统，便于与 Fooocus 交互
- 用户熟悉 Vue3，便于后续自定义修改

#### 3.1.2 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 框架 | Tauri 2.x | 桌面应用框架 |
| 前端 | Vue 3 + TypeScript | UI 框架 |
| 状态管理 | Pinia | Vue 3 官方推荐状态管理 |
| UI 组件 | Tailwind CSS + Naive UI | 现代化 UI 组件库 |
| 本地存储 | SQLite (via Tauri) | 结构化数据存储 |
| 图标 | Lucide Vue | 图标库 |

### 3.2 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                      客户端应用                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │   前端 UI   │  │  状态管理   │  │   Tauri Commands   │ │
│  │  (Vue 3)    │◄─┤  (Pinia)    │◄─┤   (Rust 后端)      │ │
│  └─────────────┘  └─────────────┘  └──────────┬──────────┘ │
│                                                │             │
│                                    ┌───────────▼──────────┐ │
│                                    │     本地存储         │ │
│                                    │     (SQLite)         │ │
│                                    └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Fooocus 目录                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  presets/   │  │ sdxl_styles/│  │   config.txt        │ │
│  │  (预设文件) │  │  (风格文件) │  │   (用户配置)        │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 功能模块设计

#### 3.3.1 主界面布局

```
┌────────────────────────────────────────────────────────────────┐
│  [Logo] Fooocus 配置管理器              [搜索框] [+新建] [⚙️] │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────────────────────────────────────────┐ │
│  │ 侧边栏   │ │                                              │ │
│  │          │ │              配置列表/卡片区域                │ │
│  │ • 全部   │ │                                              │ │
│  │ • 收藏   │ │  ┌────────┐ ┌────────┐ ┌────────┐           │ │
│  │ • 标签1  │ │  │ 配置1  │ │ 配置2  │ │ 配置3  │           │ │
│  │ • 标签2  │ │  │        │ │        │ │        │           │ │
│  │ • ...   │ │  └────────┘ └────────┘ └────────┘           │ │
│  │          │ │                                              │ │
│  │ ──────── │ │                                              │ │
│  │ + 添加标签│ │                                              │ │
│  └──────────┘ └──────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│  共 X 个配置  │  当前筛选: 全部  │  排序: 更新时间 ▼          │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.2 配置详情/编辑面板

```
┌────────────────────────────────────────────────────────────────┐
│  配置详情                                      [导出] [删除]  │
├────────────────────────────────────────────────────────────────┤
│  名称: [________________________]                ⭐ 收藏      │
│  描述: [___________________________________________________]  │
│  标签: [+添加标签]                                           │
├────────────────────────────────────────────────────────────────┤
│  ▼ 模型配置                                                   │
│    基础模型: [juggernautXL_v8RunpodDiffusion    ▼]           │
│    精修模型: [无                                ▼]           │
│    LoRA:    [+ 添加 LoRA]                                     │
├────────────────────────────────────────────────────────────────┤
│  ▼ 采样参数                                                   │
│    CFG Scale: [7.0  ]  采样锐度: [2.0  ]  步数: [30  ]       │
│    采样器:   [dpmpp_2m_sde_gpu           ▼]                  │
│    调度器:   [karras                       ▼]                │
│    性能模式: [Speed                        ▼]                │
├────────────────────────────────────────────────────────────────┤
│  ▼ 提示词配置                                                 │
│    正向提示词:                                                │
│    ┌────────────────────────────────────────────────────────┐ │
│    │ [                                                        ]│ │
│    └────────────────────────────────────────────────────────┘ │
│    反向提示词:                                                │
│    ┌────────────────────────────────────────────────────────┐ │
│    │ [                                                        ]│ │
│    └────────────────────────────────────────────────────────┘ │
│    风格: ☑ Fooocus V2  ☑ Fooocus Enhance  ☐ Fooocus Sharp   │
├────────────────────────────────────────────────────────────────┤
│  ▼ 图像参数                                                   │
│    宽高比: [1152*896  ▼]  图像数量: [4  ]                     │
├────────────────────────────────────────────────────────────────┤
│                                              [取消] [保存]    │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.3 核心模块

| 模块 | 功能 | 关键 API |
|------|------|----------|
| ConfigStore | 配置数据存储和查询 | `create()`, `update()`, `delete()`, `query()` |
| PresetImporter | 导入 Fooocus 预设 | `importFromFile()`, `parsePreset()` |
| PresetExporter | 导出为 Fooocus 预设 | `exportToFile()`, `generateJson()` |
| TagManager | 标签管理 | `createTag()`, `deleteTag()`, `getAllTags()` |
| SearchEngine | 搜索和过滤 | `search()`, `filter()`, `sort()` |
| ClipboardManager | 剪贴板操作 | `copyToClipboard()` |

### 3.4 数据模型

```typescript
interface PresetConfig {
  id: string;                    // UUID
  name: string;                  // 配置名称
  description: string;           // 描述
  tags: string[];                // 标签
  isFavorite: boolean;           // 是否收藏
  useCount: number;              // 使用次数
  createdAt: string;             // 创建时间 (ISO 8601)
  updatedAt: string;             // 更新时间 (ISO 8601)

  // 模型配置
  model: {
    baseModel: string;
    refinerModel: string;
    refinerSwitch: number;
    loras: LoRA[];
  };

  // 采样参数
  sampling: {
    cfgScale: number;
    sampleSharpness: number;
    sampler: string;
    scheduler: string;
    performance: 'Speed' | 'Quality' | 'Lightning';
    steps: number;
  };

  // 提示词
  prompt: {
    positive: string;
    negative: string;
    styles: string[];
  };

  // 图像参数
  image: {
    aspectRatio: string;
    imageCount: number;
  };

  // 资源下载（可选）
  resources?: {
    checkpointDownloads?: Record<string, string>;
    loraDownloads?: Record<string, string>;
    embeddingDownloads?: Record<string, string>;
  };
}

interface LoRA {
  name: string;
  modelName: string;
  weight: number;
}
```

### 3.5 关键流程

#### 3.5.1 创建新配置

1. 用户点击"新建"按钮
2. 打开配置编辑面板（空白模板）
3. 用户填写配置信息
4. 点击"保存"
5. 系统验证数据有效性
6. 保存到本地数据库
7. 更新配置列表

#### 3.5.2 从 Fooocus 导入配置

1. 用户点击"导入"按钮
2. 选择 Fooocus 预设文件（presets/*.json）
3. 系统解析 JSON 文件
4. 映射到内部数据模型
5. 用户可编辑确认
6. 保存到本地数据库

#### 3.5.3 导出为 Fooocus 预设

1. 用户选择配置，点击"导出"
2. 选择导出格式（Fooocus 预设 JSON）
3. 系统生成符合 Fooocus 格式的 JSON
4. 用户选择保存路径
5. 保存文件到指定位置

---

## 四、实施计划

### 4.1 开发阶段

| 阶段 | 任务 | 预计时间 |
|------|------|----------|
| Phase 1 | 项目初始化（Tauri + Vue3 环境搭建） | 1 天 |
| Phase 2 | 基础 UI 框架和布局 | 2 天 |
| Phase 3 | 配置数据模型和本地存储 | 2 天 |
| Phase 4 | 配置 CRUD 功能 | 3 天 |
| Phase 5 | 搜索和过滤功能 | 2 天 |
| Phase 6 | 导入/导出功能 | 2 天 |
| Phase 7 | 标签管理功能 | 1 天 |
| Phase 8 | 测试和优化 | 2 天 |

**总计**：约 15 个工作日

### 4.2 后续功能（可选）

- **云端同步**：支持配置云端备份和跨设备同步
- **配置分享**：生成分享链接导出配置
- **AI 建议**：基于使用历史推荐相似配置
- **插件系统**：支持用户自定义扩展

---

## 五、总结

本方案针对 Fooocus 用户管理配置的痛点，设计了一个本地运行的桌面应用（基于 Tauri + Vue3），提供配置记录、浏览、检索、导入导出等核心功能，帮助用户系统化管理 Fooocus 的模型、提示词、风格等配置信息。

该工具具有以下特点：
- **本地运行**：数据存储在本地，保护用户隐私
- **跨平台**：支持 Windows、macOS、Linux
- **轻量级**：使用 Tauri 框架，包体积小
- **易用性**：界面简洁直观，快速上手
- **可扩展**：支持导入导出，可与 Fooocus 无缝配合
- **可定制**：基于 Vue3，用户可自行修改和扩展

---

*文档版本：v1.0*  
*创建日期：2026-02-16*