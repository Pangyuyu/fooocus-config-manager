# Fooocus 配置管理器方案

## 一、项目背景

### 1.1 问题描述

Fooocus 是一款基于 Stable Diffusion 的 AI 图像生成工具，以其简洁的界面和强大的功能受到广泛欢迎。然而，在实际使用过程中，用户经常面临以下困扰：

- **配置难以记忆**：每次选择模型、设置提示词、反向提示词后，难以记住所有配置细节
- **预设管理不便**：Fooocus 的预设（Presets）存储在 JSON 文件中，需要手动编辑才能创建新预设
- **风格选择混乱**：多个风格（Styles）组合使用后，无法快速回忆之前使用过的有效组合
- **配置复用困难**：无法方便地在不同配置之间切换和比较

### 1.2 用户痛点

| 痛点 | 描述 |
|------|------|
| 记忆负担 | 需要记住多个模型、提示词、风格的组合 |
| 配置分散 | 配置信息分散在预设文件、界面状态等多个位置 |
| 复用性差 | 难以快速复用之前使用过的成功配置 |
| 缺乏记录 | 没有系统化的方式记录每次生成使用的配置 |

### 1.3 目标用户

- 频繁使用 Fooocus 进行 AI 图像生成的用户
- 需要管理多个模型和预设的专业设计师
- 希望建立个人配置知识库的 AI 爱好者

---

## 二、需求分析

### 2.1 需要记录的配置项

根据 Fooocus 的预设（Preset）结构和实际使用场景，本工具需要管理以下配置项：

#### 2.1.1 核心配置

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 预设名称 | 配置方案的名称 | string |
| 预设描述 | 配置方案的简要描述 | string |
| 创建时间 | 记录创建时间 | datetime |
| 更新时间 | 记录最后修改时间 | datetime |
| 标签 | 用于分类和检索 | string[] |

#### 2.1.2 模型配置

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 基础模型 | 主要使用的 Checkpoint 模型 | string |
| 精修模型 | Refiner 模型（可选） | string |
| 精修切换点 | Refiner 切换的步数比例 | float |
| LoRA 模型 | 使用的 LoRA 及权重 | LoRA[] |

```
LoRA 结构:
{
  "name": string,        // LoRA 名称
  "model_name": string,  // 模型文件名
  "weight": float        // 权重 (-1 ~ 2)
}
```

#### 2.1.3 采样参数

| 配置项 | 说明 | 数据类型 | 常见值 |
|--------|------|----------|--------|
| CFG Scale | 引导强度 | float | 1.0 ~ 30.0 |
| 采样锐度 | 图像锐度 | float | 0.0 ~ 10.0 |
| 采样器 | 采样算法 | enum | dpmpp_2m_sde_gpu, euler, etc. |
| 调度器 | 噪声调度方式 | enum | karras, normal, etc. |
| 性能模式 | 生成速度/质量平衡 | enum | Speed, Quality, Lightning |
| 步数 | 采样步数 | int | 1 ~ 200 |

#### 2.1.4 提示词配置

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 正向提示词 | 主要的生成描述 | string |
| 反向提示词 | 需要避免的元素 | string |
| 风格列表 | 启用的风格 | string[] |

#### 2.1.5 图像参数

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 宽高比 | 输出图像尺寸 | string (如 "1152*896") |
| 图像数量 | 同时生成的图像数 | int |

#### 2.1.6 资源下载（可选）

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 模型下载链接 | Checkpoint 下载地址 | map |
| LoRA 下载链接 | LoRA 模型下载地址 | map |
| Embedding 下载链接 | Textual Inversion 下载地址 | map |

#### 2.1.7 模型信息管理

| 配置项 | 说明 | 数据类型 |
|--------|------|----------|
| 模型ID | 唯一标识 | string (UUID) |
| 模型名称 | 显示名称，便于识别 | string |
| 模型文件名 | 实际的模型文件名 | string |
| 模型类型 | Checkpoint/LoRA/Refiner/Embedding | enum |
| 模型简介 | 模型的详细描述 | string |
| 适用范围 | 适用场景标签（如：人像、风景、动漫等） | string[] |
| 模型地址 | 本地存储路径或下载链接 | string |
| 自定义标签 | 用户自定义分类标签 | string[] |
| 创建时间 | 记录创建时间 | datetime |
| 更新时间 | 记录最后修改时间 | datetime |

### 2.2 功能需求

#### 2.2.1 配置记录与管理

- **创建配置**：手动创建新的配置方案
- **导入配置**：从 Fooocus 预设 JSON 文件导入
- **编辑配置**：修改现有配置的任意字段
- **删除配置**：删除不需要的配置
- **复制配置**：基于现有配置创建副本
- **收藏配置**：标记常用的配置为收藏

#### 2.2.2 配置浏览与检索

- **列表视图**：以列表形式展示所有配置
- **卡片视图**：以卡片形式展示配置概览
- **搜索功能**：按名称、标签、模型等关键词搜索
- **筛选功能**：按标签、模型、创建时间等条件筛选
- **排序功能**：按名称、更新时间、使用频率等排序

#### 2.2.3 配置导出

- **导出为 Fooocus 预设**：生成符合 Fooocus 格式的 JSON 文件
- **导出为图片元数据**：将配置信息写入图片的 EXIF 数据
- **批量导出**：一次性导出多个配置

#### 2.2.4 配置使用

- **一键应用**：快速将配置复制到剪贴板或直接应用到 Fooocus
- **快速预览**：查看配置的详细信息
- **对比模式**：并排比较两个配置的区别

#### 2.2.5 数据管理

- **数据持久化**：本地存储配置数据
- **数据导入/导出**：备份和恢复整个配置库
- **数据统计**：展示配置使用统计（使用次数、创建时间分布等）

#### 2.2.6 模型信息管理

- **添加模型**：手动添加新的模型信息
- **编辑模型**：修改模型的名称、简介、适用范围等信息
- **删除模型**：删除不需要的模型记录
- **模型分类**：按模型类型（Checkpoint/LoRA/Refiner/Embedding）分类查看
- **模型搜索**：按名称、标签、适用范围等关键词搜索
- **模型筛选**：按类型、标签等条件筛选
- **模型详情**：查看模型的完整信息，包括简介、适用范围、地址等
- **关联预设**：查看使用该模型的所有预设配置（可选）

### 2.3 非功能需求

- **易用性**：界面简洁直观，学习成本低
- **性能**：配置加载和搜索响应时间 < 200ms
- **兼容性**：支持 Windows、macOS、Linux
- **可扩展性**：方便添加新的配置项和功能
- **数据安全**：本地存储，无云端传输，保护用户隐私

---

## 三、方案设计

### 3.1 技术选型

#### 3.1.1 界面形式：桌面应用（本地运行）

**推荐方案**：使用 Tauri + Vue3 构建桌面应用

| 方案 | 优点 | 缺点 |
|------|------|------|
| Electron + Vue3 | 跨平台、原生体验、可访问本地文件系统 | 包体积较大 |
| Tauri + Vue3 | 包体积小、性能好、安全性高 | 生态相对较小 |
| Vue3 单页应用 | 开发简单、可部署到任意静态服务器 | 需要手动处理本地存储 |

**最终推荐**：**Tauri + Vue3**

理由：
- 轻量级，包体积小（~10MB vs Electron 的 ~150MB）
- 性能优秀，启动速度快
- 安全性好，默认禁用远程代码执行
- 可以轻松读写本地文件系统，便于与 Fooocus 交互
- 用户熟悉 Vue3，便于后续自定义修改

#### 3.1.2 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 框架 | Tauri 2.x | 桌面应用框架 |
| 前端 | Vue 3 + TypeScript | UI 框架 |
| 状态管理 | Pinia | Vue 3 官方推荐状态管理 |
| UI 组件 | Tailwind CSS + Naive UI | 现代化 UI 组件库 |
| 本地存储 | SQLite (via Tauri) | 结构化数据存储 |
| 图标 | Lucide Vue | 图标库 |

### 3.2 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                      客户端应用                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │   前端 UI   │  │  状态管理   │  │   Tauri Commands   │ │
│  │  (Vue 3)    │◄─┤  (Pinia)    │◄─┤   (Rust 后端)      │ │
│  └─────────────┘  └─────────────┘  └──────────┬──────────┘ │
│                                                │             │
│                                    ┌───────────▼──────────┐ │
│                                    │     本地存储         │ │
│                                    │     (SQLite)         │ │
│                                    └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Fooocus 目录                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  presets/   │  │ sdxl_styles/│  │   config.txt        │ │
│  │  (预设文件) │  │  (风格文件) │  │   (用户配置)        │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 功能模块设计

#### 3.3.1 主界面布局

```
┌────────────────────────────────────────────────────────────────┐
│  [Logo] Fooocus 配置管理器              [搜索框] [+新建] [⚙️] │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────────────────────────────────────────┐ │
│  │ 侧边栏   │ │                                              │ │
│  │          │ │              配置列表/卡片区域                │ │
│  │ • 全部   │ │                                              │ │
│  │ • 收藏   │ │  ┌────────┐ ┌────────┐ ┌────────┐           │ │
│  │ • 标签1  │ │  │ 配置1  │ │ 配置2  │ │ 配置3  │           │ │
│  │ • 标签2  │ │  │        │ │        │ │        │           │ │
│  │ • ...   │ │  └────────┘ └────────┘ └────────┘           │ │
│  │          │ │                                              │ │
│  │ ──────── │ │                                              │ │
│  │ 模型管理 │ │                                              │ │
│  │ • Checkpoint│                                            │ │
│  │ • LoRA   │ │                                              │ │
│  │ • Refiner│ │                                              │ │
│  │ • Embedding│                                            │ │
│  │ ──────── │ │                                              │ │
│  │ + 添加标签│ │                                              │ │
│  └──────────┘ └──────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│  共 X 个配置  │  当前筛选: 全部  │  排序: 更新时间 ▼          │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.2 模型管理界面布局

```
┌────────────────────────────────────────────────────────────────┐
│  [Logo] Fooocus 配置管理器              [搜索框] [+添加模型]  │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────────────────────────────────────────┐ │
│  │ 侧边栏   │ │                                              │ │
│  │          │ │              模型列表/卡片区域                │ │
│  │ • 全部   │ │                                              │ │
│  │ • Checkpoint│  ┌────────────────────────────────────────┐ │ │
│  │ • LoRA   │ │  │ 模型名称: juggernautXL_v8              │ │ │
│  │ • Refiner│ │  │ 类型: Checkpoint                       │ │ │
│  │ • Embedding│ │ 适用范围: 人像, 写实, 通用              │ │ │
│  │          │ │  │ 简介: 高质量写实风格大模型...           │ │ │
│  │          │ │  │ 地址: D:\models\juggernautXL_v8.safetensors│ │
│  │          │ │  │                        [编辑] [删除]   │ │ │
│  │          │ │  └────────────────────────────────────────┘ │ │
│  │          │ │                                              │ │
│  │          │ │  ┌────────────────────────────────────────┐ │ │
│  │          │ │  │ 模型名称: detail_tweaker              │ │ │
│  │          │ │  │ 类型: LoRA                             │ │ │
│  │          │ │  │ 适用范围: 细节增强, 通用               │ │ │
│  │          │ │  │ 简介: 增强图像细节的LoRA...            │ │ │
│  │          │ │  │                        [编辑] [删除]   │ │ │
│  │          │ │  └────────────────────────────────────────┘ │ │
│  └──────────┘ └──────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│  共 X 个模型  │  当前类型: 全部  │  排序: 更新时间 ▼         │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.3 模型编辑面板

```
┌────────────────────────────────────────────────────────────────┐
│  添加/编辑模型                                                │
├────────────────────────────────────────────────────────────────┤
│  模型名称: [________________________________________]         │
│  模型文件名: [____________________________________]          │
│  模型类型: [Checkpoint          ▼]                           │
├────────────────────────────────────────────────────────────────┤
│  模型简介:                                                    │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                                                            │ │
│  │  [多行文本输入区域]                                        │ │
│  │                                                            │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│  适用范围:                                                    │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ [人像] [写实] [动漫] [风景] [+ 添加]                      │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│  模型地址:                                                    │
│  ┌────────────────────────────────────────────────────────┐   │
│  │ [本地路径或下载链接]                        [浏览...]   │   │
│  └────────────────────────────────────────────────────────┘   │
├────────────────────────────────────────────────────────────────┤
│  自定义标签:                                                  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ [标签1] [标签2] [+ 添加]                                  │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│                                              [取消] [保存]    │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.4 配置详情/编辑面板

```
┌────────────────────────────────────────────────────────────────┐
│  配置详情                                      [导出] [删除]  │
├────────────────────────────────────────────────────────────────┤
│  名称: [________________________]                ⭐ 收藏      │
│  描述: [___________________________________________________]  │
│  标签: [+添加标签]                                           │
├────────────────────────────────────────────────────────────────┤
│  ▼ 模型配置                                                   │
│    基础模型: [juggernautXL_v8RunpodDiffusion    ▼]           │
│    精修模型: [无                                ▼]           │
│    LoRA:    [+ 添加 LoRA]                                     │
├────────────────────────────────────────────────────────────────┤
│  ▼ 采样参数                                                   │
│    CFG Scale: [7.0  ]  采样锐度: [2.0  ]  步数: [30  ]       │
│    采样器:   [dpmpp_2m_sde_gpu           ▼]                  │
│    调度器:   [karras                       ▼]                │
│    性能模式: [Speed                        ▼]                │
├────────────────────────────────────────────────────────────────┤
│  ▼ 提示词配置                                                 │
│    正向提示词:                                                │
│    ┌────────────────────────────────────────────────────────┐ │
│    │ [                                                        ]│ │
│    └────────────────────────────────────────────────────────┘ │
│    反向提示词:                                                │
│    ┌────────────────────────────────────────────────────────┐ │
│    │ [                                                        ]│ │
│    └────────────────────────────────────────────────────────┘ │
│    风格: ☑ Fooocus V2  ☑ Fooocus Enhance  ☐ Fooocus Sharp   │
├────────────────────────────────────────────────────────────────┤
│  ▼ 图像参数                                                   │
│    宽高比: [1152*896  ▼]  图像数量: [4  ]                     │
├────────────────────────────────────────────────────────────────┤
│                                              [取消] [保存]    │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.5 核心模块

| 模块 | 功能 | 关键 API |
|------|------|----------|
| ConfigStore | 配置数据存储和查询 | `create()`, `update()`, `delete()`, `query()` |
| PresetImporter | 导入 Fooocus 预设 | `importFromFile()`, `parsePreset()` |
| PresetExporter | 导出为 Fooocus 预设 | `exportToFile()`, `generateJson()` |
| TagManager | 标签管理 | `createTag()`, `deleteTag()`, `getAllTags()` |
| SearchEngine | 搜索和过滤 | `search()`, `filter()`, `sort()` |
| ClipboardManager | 剪贴板操作 | `copyToClipboard()` |
| ModelStore | 模型信息存储和查询 | `createModel()`, `updateModel()`, `deleteModel()`, `queryModels()` |
| ModelTypeFilter | 模型类型筛选 | `filterByType()`, `getModelsByType()` |

### 3.4 数据模型

```typescript
interface PresetConfig {
  id: string;                    // UUID
  name: string;                  // 配置名称
  description: string;           // 描述
  tags: string[];                // 标签
  isFavorite: boolean;           // 是否收藏
  useCount: number;              // 使用次数
  createdAt: string;             // 创建时间 (ISO 8601)
  updatedAt: string;             // 更新时间 (ISO 8601)

  // 模型配置
  model: {
    baseModel: string;
    refinerModel: string;
    refinerSwitch: number;
    loras: LoRA[];
  };

  // 采样参数
  sampling: {
    cfgScale: number;
    sampleSharpness: number;
    sampler: string;
    scheduler: string;
    performance: 'Speed' | 'Quality' | 'Lightning';
    steps: number;
  };

  // 提示词
  prompt: {
    positive: string;
    negative: string;
    styles: string[];
  };

  // 图像参数
  image: {
    aspectRatio: string;
    imageCount: number;
  };

  // 资源下载（可选）
  resources?: {
    checkpointDownloads?: Record<string, string>;
    loraDownloads?: Record<string, string>;
    embeddingDownloads?: Record<string, string>;
  };
}

interface LoRA {
  name: string;
  modelName: string;
  weight: number;
}

// 模型信息管理
type ModelType = 'Checkpoint' | 'LoRA' | 'Refiner' | 'Embedding';

interface ModelInfo {
  id: string;                    // UUID
  name: string;                  // 模型名称（显示名称）
  fileName: string;              // 模型文件名
  type: ModelType;               // 模型类型
  description: string;           // 模型简介
  scope: string[];               // 适用范围标签
  path: string;                  // 模型地址（本地路径或下载链接）
  tags: string[];                // 自定义标签
  createdAt: string;             // 创建时间 (ISO 8601)
  updatedAt: string;             // 更新时间 (ISO 8601)
}
```

### 3.5 关键流程

#### 3.5.1 创建新配置

1. 用户点击"新建"按钮
2. 打开配置编辑面板（空白模板）
3. 用户填写配置信息
4. 点击"保存"
5. 系统验证数据有效性
6. 保存到本地数据库
7. 更新配置列表

#### 3.5.2 从 Fooocus 导入配置

1. 用户点击"导入"按钮
2. 选择 Fooocus 预设文件（presets/*.json）
3. 系统解析 JSON 文件
4. 映射到内部数据模型
5. 用户可编辑确认
6. 保存到本地数据库

#### 3.5.3 导出为 Fooocus 预设

1. 用户选择配置，点击"导出"
2. 选择导出格式（Fooocus 预设 JSON）
3. 系统生成符合 Fooocus 格式的 JSON
4. 用户选择保存路径
5. 保存文件到指定位置

---

## 四、实施计划

### 4.1 开发阶段

| 阶段 | 任务 | 预计时间 |
|------|------|----------|
| Phase 1 | 项目初始化（Tauri + Vue3 环境搭建） | 1 天 |
| Phase 2 | 基础 UI 框架和布局 | 2 天 |
| Phase 3 | 配置数据模型和本地存储 | 2 天 |
| Phase 4 | 配置 CRUD 功能 | 3 天 |
| Phase 5 | 搜索和过滤功能 | 2 天 |
| Phase 6 | 导入/导出功能 | 2 天 |
| Phase 7 | 标签管理功能 | 1 天 |
| Phase 8 | 模型信息管理功能 | 2 天 |
| Phase 9 | 测试和优化 | 2 天 |

**总计**：约 17 个工作日

### 4.2 后续功能（可选）

- **云端同步**：支持配置云端备份和跨设备同步
- **配置分享**：生成分享链接导出配置
- **AI 建议**：基于使用历史推荐相似配置
- **插件系统**：支持用户自定义扩展

---

## 六、配置与模型关联整改方案

### 6.1 问题描述

当前系统中存在两个独立的数据模块：
- **配置（Preset）**：包含模型名称字段（`baseModel`、`refinerModel`、`loras[].modelName`）
- **模型信息（ModelInfo）**：独立管理的模型实体，包含 ID、名称、描述等详细信息

**核心问题**：两者之间没有建立关联关系，导致：
1. 编辑配置时只能手动输入模型名称，无法从已管理的模型中选择
2. 无法查看某个模型被哪些配置使用
3. 删除模型时无法检查是否被配置引用
4. 数据冗余：模型名称在两处独立维护，容易出现不一致

### 6.2 整改目标

1. **建立关联关系**：配置中的模型字段关联到模型信息表
2. **选择器增强**：编辑配置时通过下拉选择器选择已管理的模型
3. **反向查询**：在模型详情中显示使用该模型的所有配置
4. **数据一致性**：删除模型时检查是否被引用，提供警告

### 6.3 数据结构修改

#### 6.3.1 前端类型定义修改

**修改 `ModelConfig` 接口**：
```typescript
export interface LoRA {
  name: string;           // LoRA 显示名称
  modelName: string;      // 模型文件名
  weight: number;         // 权重
  modelId?: string;       // 新增：关联的模型信息 ID（可选）
}

export interface ModelConfig {
  baseModel: string;           // 基础模型名称（保持兼容）
  baseModelId?: string;        // 新增：关联的模型信息 ID
  refinerModel: string;        // 精修模型名称（保持兼容）
  refinerModelId?: string;     // 新增：关联的模型信息 ID
  refinerSwitch: number;
  loras: LoRA[];
}
```

**设计原则**：
- 保留原有的 `name`/`modelName` 字段，确保向后兼容
- 新增 `modelId` 字段用于关联，可选字段（允许用户只输入名称而不关联模型信息）
- 当用户通过选择器选择模型时，同时填充名称和 ID

#### 6.3.2 数据库结构修改

数据库层面无需修改表结构，因为：
- `model_config` 字段以 JSON 形式存储在 `presets` 表中
- 新增的 ID 字段会自动包含在 JSON 中

### 6.4 功能实现方案

#### 6.4.1 PresetEditor 组件改造

**模型选择器设计**：
```
┌─────────────────────────────────────────────────────────────┐
│ 基础模型: [juggernautXL_v8          ▼] [查看详情]          │
│           ┌─────────────────────────────────────────────┐  │
│           │ 🔍 搜索模型...                              │  │
│           │ ─────────────────────────────────────────── │  │
│           │ 📦 juggernautXL_v8                          │  │
│           │ 📦 realisticVision_v5                       │  │
│           │ 📦 sd_xl_base_1.0                           │  │
│           │ ─────────────────────────────────────────── │  │
│           │ ➕ 添加新模型...                             │  │
│           └─────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**交互逻辑**：
1. 下拉选择器显示所有 Checkpoint 类型的模型
2. 选择模型后，自动填充 `baseModel`（名称）和 `baseModelId`（ID）
3. 支持搜索过滤
4. 提供"查看详情"按钮，点击可查看模型完整信息
5. 支持手动输入（不关联模型信息）

**LoRA 选择器**：
- 类似设计，显示所有 LoRA 类型的模型
- 支持添加多个 LoRA，每个 LoRA 可独立选择

#### 6.4.2 模型详情页增强

在 ModelCard 或 ModelEditor 中新增"关联配置"标签页：
```
┌─────────────────────────────────────────────────────────────┐
│ 模型详情: juggernautXL_v8                                  │
├─────────────────────────────────────────────────────────────┤
│ [基本信息] [关联配置 (3)]                                  │
│                                                             │
│ 使用此模型的配置：                                          │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 📋 人像写实配置 v2                      基础模型        ││
│ │ 📋 动漫风格配置                         基础模型        ││
│ │ 📋 通用高质量配置                       基础模型        ││
│ └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

#### 6.4.3 删除模型时的检查

删除模型前检查是否被配置引用：
```
┌─────────────────────────────────────────────────────────────┐
│ ⚠️ 警告                                                    │
│                                                             │
│ 模型 "juggernautXL_v8" 被 3 个配置引用：                    │
│ • 人像写实配置 v2                                          │
│ • 动漫风格配置                                             │
│ • 通用高质量配置                                           │
│                                                             │
│ 删除后，这些配置中的模型关联将失效（名称保留）。           │
│                                                             │
│ [取消] [仍然删除]                                          │
└─────────────────────────────────────────────────────────────┘
```

### 6.5 后端 API 新增

#### 6.5.1 查询使用指定模型的配置

```rust
#[tauri::command]
pub fn get_presets_by_model_id(db: State<'_, Database>, model_id: String) -> Result<Vec<PresetConfig>, String>
```

返回所有引用了指定模型 ID 的配置列表。

#### 6.5.2 检查模型是否被引用

```rust
#[tauri::command]
pub fn check_model_usage(db: State<'_, Database>, model_id: String) -> Result<ModelUsageInfo, String>

pub struct ModelUsageInfo {
    pub is_used: bool,
    pub usage_count: i32,
    pub preset_names: Vec<String>,
}
```

### 6.6 实施步骤

| 步骤 | 任务 | 涉及文件 |
|------|------|----------|
| 1 | 修改前端类型定义 | `src/types/index.ts` |
| 2 | 修改后端数据结构 | `src-tauri/src/database.rs` |
| 3 | 新增后端 API | `src-tauri/src/commands.rs` |
| 4 | 修改 PresetEditor 组件 | `src/components/PresetEditor.vue` |
| 5 | 新增模型选择器组件 | `src/components/ModelSelector.vue` |
| 6 | 修改 ModelCard 组件 | `src/components/ModelCard.vue` |
| 7 | 新增关联配置查看组件 | `src/components/ModelUsagePanel.vue` |
| 8 | 更新 Store | `src/stores/modelStore.ts`, `src/stores/presetStore.ts` |

### 6.7 兼容性考虑

1. **向后兼容**：新增的 ID 字段为可选，旧数据不受影响
2. **渐进式迁移**：用户可以逐步为现有配置关联模型信息
3. **手动输入保留**：用户仍可手动输入模型名称，不强制关联

---

## 七、总结

本方案针对 Fooocus 用户管理配置的痛点，设计了一个本地运行的桌面应用（基于 Tauri + Vue3），提供配置记录、浏览、检索、导入导出等核心功能，帮助用户系统化管理 Fooocus 的模型、提示词、风格等配置信息。

该工具具有以下特点：
- **本地运行**：数据存储在本地，保护用户隐私
- **跨平台**：支持 Windows、macOS、Linux
- **轻量级**：使用 Tauri 框架，包体积小
- **易用性**：界面简洁直观，快速上手
- **可扩展**：支持导入导出，可与 Fooocus 无缝配合
- **可定制**：基于 Vue3，用户可自行修改和扩展

---

*文档版本：v1.2*  
*创建日期：2026-02-16*
*更新日期：2026-02-19*
*更新内容：新增配置与模型关联整改方案*